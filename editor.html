<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link rel="icon" href="./assets/images/favicon.png">
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/css/fontawsome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="./assets/css/style.css">
    <title>Update Lower Third Editor</title>
</head>

<body>
    <main class="mainArea">
        <div class="headerArea">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-3 col-lg-3 col-md-3 col-6">
                        <div class="headerLogo">
                            <a href="/dashboard.html">
                                <img src="./assets/images/logo.svg" alt="">
                            </a>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-md-6 col-12 mobile-order-3">
                        <div class="middleHeader text-center">
                            <h4>Editor</h4>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-3 col-6">
                        <div class="text-end userDropdown">
                            <div class="btn-group">
                                <button type="button" class="dropdownButton" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                    <img src="https://htmlstream.com/preview/front-dashboard-v2.1.1/assets/img/160x160/img6.jpg"
                                        alt="">
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <div class="topUserDetails">
                                        <div class="userImage">
                                            <img src="https://htmlstream.com/preview/front-dashboard-v2.1.1/assets/img/160x160/img6.jpg"
                                                alt="">
                                        </div>
                                        <div class="userInfo">
                                            <h4>Jhone Doe</h4>
                                            <p>jhondoe@gmail.com</p>
                                        </div>
                                    </div>
                                    <div class="dropdownLink">
                                        <ul>
                                            <li>
                                                <a href="#">
                                                    <i class="fa-light fa-user"></i>
                                                    Profile & account
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <i class="fa-light fa-gear"></i>
                                                    Settings
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <i class="fa-light fa-folders"></i>
                                                    My project
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="lastLinkDropdown">
                                        <ul>
                                            <li>
                                                <a href="#" onclick="logout()">
                                                    <i class="fa-regular fa-arrow-right-from-bracket"></i>
                                                    Sign out
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </ul>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="mainEditorWrapper">
                        <div class="left">
                            <a href="/dashboard.html" class="backButton">
                                <i class="fa-solid fa-arrow-left-long"></i>
                                Back To Dashboard
                            </a>
                            <div class="accordion mt-3" id="controllAcordion">
                                <!-- text control item -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                            data-bs-target="#collapseOne" aria-expanded="true"
                                            aria-controls="collapseOne">
                                            <div class="acordionIcon"><i class="fa-solid fa-text-size"></i></div>
                                            <span>Text</span>
                                            <div class="toggleButton">
                                                <i class="fa-sharp fa-solid fa-sort-down"></i>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse show"
                                        data-bs-parent="#controllAcordion">
                                        <div class="accordion-body">
                                            <div class="fortextLine1">
                                                <h4 class="topHeading">For text line 1</h4>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                            id="enableLine1" checked onchange="toggleLine(1)">
                                                        <label class="form-check-label" for="enableLine1">Enable</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" id="text1"
                                                            oninput="updateText(1)" placeholder="">
                                                        <label for="text1">Enter text line</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-floating">
                                                        <select class="form-select font-selector" id="fontFamily1"
                                                            onchange="updateFontFamily(1)" id="floatingSelect"
                                                            aria-label="Floating label select example">
                                                            <option selected>Choose fonts from list</option>
                                                            <option value="1">One</option>
                                                            <option value="2">Two</option>
                                                            <option value="3">Three</option>
                                                        </select>
                                                        <label for="fontFamily1">Select font</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <label class="topLabel">Size</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="fontSize1" min="10"
                                                            max="100" value="50" oninput="updateFontSize(1)">
                                                        <div class="rightInfoValue"><span id="fontSizeValue1">50</span>
                                                            px
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <label class="topLabel">Position</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="positionY1" min="700"
                                                            max="1000" value="750" oninput="updateTextPosition(1)">
                                                        <!-- <div class="rightInfoValue"><span id="positionValue1">750</span> px
                                                    </div> -->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="fortextLine2">
                                                <h4 class="topHeading">For text line 2</h4>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                            id="enableLine2" checked onchange="toggleLine(2)">
                                                        <label class="form-check-label" for="enableLine2">Enable</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" id="text2"
                                                            oninput="updateText(2)" placeholder="">
                                                        <label for="text2">Enter text line</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-floating">
                                                        <select class="form-select font-selector" id="fontFamily2"
                                                            onchange="updateFontFamily(2)"
                                                            aria-label="Floating label select example">
                                                            <option selected>Choose fonts from list</option>
                                                            <option value="1">One</option>
                                                            <option value="2">Two</option>
                                                            <option value="3">Three</option>
                                                        </select>
                                                        <label for="fontFamily2">Select font</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <label class="topLabel">Size</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="fontSize2" min="10"
                                                            max="100" value="35" oninput="updateFontSize(2)">
                                                        <div class="rightInfoValue"><span id="fontSizeValue2">35</span>
                                                            px
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <label class="topLabel">Position</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="positionY2" min="750"
                                                            max="1050" value="1000" oninput="updateTextPosition(2)">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="fortextLine3">
                                                <h4 class="topHeading">For text line 3</h4>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                            id="enableLine3" checked onchange="toggleLine(3)">
                                                        <label class="form-check-label" for="enableLine3">Enable</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" id="text3"
                                                            oninput="updateText(3)" placeholder="">
                                                        <label for="text3">Enter text line</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <div class="form-floating">
                                                        <select class="form-select font-selector" id="fontFamily3"
                                                            onchange="updateFontFamily(3)"
                                                            aria-label="Floating label select example">
                                                            <option selected>Choose fonts from list</option>
                                                            <option value="1">One</option>
                                                            <option value="2">Two</option>
                                                            <option value="3">Three</option>
                                                        </select>
                                                        <label for="fontFamily3">Select font</label>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <label class="topLabel">Size</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="fontSize3" min="10"
                                                            max="100" value="31" oninput="updateFontSize(3)">
                                                        <div class="rightInfoValue"><span id="fontSizeValue3">31</span>
                                                            px
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- single item -->
                                                <div class="singleController">
                                                    <label class="topLabel">Position</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="positionY3" min="800"
                                                            max="1100" value="850" oninput="updateTextPosition(3)">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- design control item -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseTwo"
                                            aria-expanded="false" aria-controls="collapseTwo">
                                            <div class="acordionIcon">
                                                <i class="fa-light fa-object-group"></i>
                                            </div>
                                            <span>Design</span>
                                            <div class="toggleButton">
                                                <i class="fa-sharp fa-solid fa-sort-down"></i>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapseTwo" class="accordion-collapse collapse"
                                        data-bs-parent="#controllAcordion">
                                        <div class="accordion-body">
                                            <div class="fortextLine1">
                                                <div class="singleController">
                                                    <label class="topLabel">Font Color</label>
                                                    <div class="rangeDiv">
                                                        <input type="color" id="fontColor" class="colorControl"
                                                            value="#ffffff" oninput="updateFontColor()">
                                                    </div>
                                                </div>
                                                <div class="singleController">
                                                    <label class="topLabel">Color Fill</label>
                                                    <div class="form-floating">
                                                        <select class="form-select" id="rectType"
                                                            onchange="toggleRectangleSettings()">
                                                            <option value="solid">Solid Color</option>
                                                            <option value="gradient">Gradient</option>
                                                        </select>
                                                        <label for="rectType">Select Fill Style</label>
                                                    </div>
                                                </div>
                                                <div id="solidColorSettings" class="singleController">
                                                    <label class="topLabel">Background Color</label>
                                                    <div class="rangeDiv">
                                                        <input type="color" id="bgColor" class="colorControl"
                                                            value="#154c79" oninput="updateBgColor()">
                                                    </div>
                                                </div>
                                                <div id="gradientSettings" style="display: none;">
                                                    <div class="singleController">
                                                        <div class="row">
                                                            <div class="col-6">
                                                                <label class="topLabel">Gradient Color 1</label>
                                                                <input type="color" id="gradientColor1"
                                                                    class="colorControl" value="#154c79"
                                                                    oninput="updateGradient()">
                                                            </div>
                                                            <div class="col-6">
                                                                <label class="topLabel">Gradient Color 2</label>
                                                                <input type="color" id="gradientColor2"
                                                                    class="colorControl" value="#00aaff"
                                                                    oninput="updateGradient()">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="singleController">
                                                        <label class="topLabel">Gradient Direction</label>
                                                        <div class="form-floating">
                                                            <select class="form-select" id="gradientDirection"
                                                                onchange="updateGradient()">
                                                                <option value="top-bottom">Top to Bottom</option>
                                                                <option value="left-right">Left to Right</option>
                                                                <option value="diagonal">Diagonal</option>
                                                            </select>
                                                            <label for="rectType">Select Direction</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="singleController">
                                                    <label class="topLabel">Opacity</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="bgOpacity" min="0"
                                                            max="100" value="100" oninput="updateBgOpacity()">
                                                        <div class="rightInfoValue"><span
                                                                id="bgOpacityValue">100%</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="fortextLine1">
                                                <div class="singleController">
                                                    <label class="topLabel">Left Crop</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="leftCrop" min="0"
                                                            max="100" value="0" oninput="updateBoxCrop()">
                                                        <div class="rightInfoValue"><span id="leftCropValue">0%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="singleController">
                                                    <label class="topLabel">Right Crop</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="rightCrop" min="0"
                                                            max="100" value="0" oninput="updateBoxCrop()">
                                                        <div class="rightInfoValue"><span id="rightCropValue">0%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="singleController">
                                                    <label class="topLabel">Rounded Edges</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="roundedEdges" min="0"
                                                            max="100" value="0" oninput="updateRoundedEdges()">
                                                        <div class="rightInfoValue"><span
                                                                id="roundedEdgesValue">0%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="fortextLine1">
                                                <div class="singleController">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                            id="strokeEnabled" onchange="toggleStroke()">
                                                        <label class="form-check-label" for="strokeEnabled">Enable
                                                            Stroke</label>
                                                    </div>
                                                </div>
                                                <div id="strokeSettings">
                                                    <div class="singleController">
                                                        <label class="topLabel">Stroke Thickness</label>
                                                        <div class="rangeDiv">
                                                            <input type="range" class="form-range" id="strokeWidth"
                                                                min="1" max="20" value="2" oninput="updateStroke()">
                                                            <div class="rightInfoValue"><span
                                                                    id="strokeWidthValue">2px</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="singleController">
                                                        <label class="topLabel">Stroke Color</label>
                                                        <div class="rangeDiv">
                                                            <input type="color" id="strokeColor" class="colorControl"
                                                                value="#ffffff" oninput="updateStroke()">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- align control -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#alignToggle"
                                            aria-expanded="false" aria-controls="collapseTwo">
                                            <div class="acordionIcon">
                                                <i class="fa-regular fa-square-sliders-vertical"></i>
                                            </div>
                                            <span>Align</span>
                                            <div class="toggleButton">
                                                <i class="fa-sharp fa-solid fa-sort-down"></i>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="alignToggle" class="accordion-collapse collapse"
                                        data-bs-parent="#controllAcordion">
                                        <div class="accordion-body">
                                            <div class="fortextLine1">
                                                <div class="singleController">
                                                    <label class="topLabel">Text Alignment</label>
                                                    <div class="form-floating">
                                                        <select class="form-select" id="textAlignment"
                                                            onchange="updateTextAlignment()"
                                                            aria-label="Floating label select example">
                                                            <option value="left">Left</option>
                                                            <option value="center">Center</option>
                                                            <option value="right">Right</option>
                                                        </select>
                                                        <label for="fontFamily1">Select align </label>
                                                    </div>
                                                </div>
                                                <div class="singleController">
                                                    <label class="topLabel">Text Margin</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="textMargin"
                                                            min="-100" max="100" value="0">
                                                        <div class="rightInfoValue"><span id="textMarginValue">40</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="singleController">
                                                    <label class="topLabel">Rectangle Height</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="rectHeight" min="50"
                                                            max="200" value="100" oninput="updateRectangleHeight()">
                                                        <div class="rightInfoValue"><span
                                                                id="rectHeightValue">100%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="singleController">
                                                    <label class="topLabel">Vertical Position</label>
                                                    <div class="rangeDiv">
                                                        <input type="range" class="form-range" id="verticalPosition"
                                                            min="-100" max="100" value="0">
                                                        <div class="rightInfoValue"><span
                                                                id="verticalPositionValue">0%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- canvas preview -->
                        <div class="right text-center sticky-top">
                            <canvas id="lowerThirdCanvas" width="768" height="432"></canvas>
                            <div class="userActionButton">
                                <div class="topButtonRow">
                                    <div class="form-floating resolutaionSelect">
                                        <select class="form-select" id="resolutionToggle"
                                            aria-label="Floating label select example">
                                            <option value="hd" selected>HD (1920x1080)</option>
                                            <option value="4k">4K (3840x2160)</option>
                                        </select>
                                        <label for="resolutionToggle">Select Resolution</label>
                                    </div>
                                    <button class="btn btn-primary" onclick="resetLowerThird()">
                                        <i class="fa-regular fa-eraser"></i>
                                        Reset
                                    </button>
                                    <button class="btn btn-primary">
                                        <i class="fa-regular fa-floppy-disk"></i>
                                        Save Project
                                    </button>
                                </div>
                                <div class="bottomButton">
                                    <button class="btn btn-primary" onclick="exportAsPNG()">
                                        <i class="fa-regular fa-folder-arrow-down"></i>
                                        Download PNG
                                    </button>
                                    <button class="btn btn-primary" onclick="returnToDashboard()">
                                        <i class="fa-solid fa-arrow-left-long"></i>
                                        Return to Dashboard
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mobileMenu">
            <div class="mobileMenuInner">
                <button type="button" data-bs-toggle="offcanvas" data-bs-target="#textOffcanvas">
                    <div class="icon">
                        <i class="fa-solid fa-text-size"></i>
                    </div>
                    <h5>Text</h5>
                </button>
                <button type="button" data-bs-toggle="offcanvas" data-bs-target="#designOffcanvas">
                    <div class="icon">
                        <i class="fa-light fa-object-group"></i>
                    </div>
                    <h5>Design</h5>
                </button>
                <button type="button" data-bs-toggle="offcanvas" data-bs-target="#alignmentOffcanvas">
                    <div class="icon">
                        <i class="fa-regular fa-square-sliders-vertical"></i>
                    </div>
                    <h5>Alignments</h5>
                </button>
            </div>
        </div>
    </main>
    <!-- text option off canvas -->
    <div class="offcanvas offcanvas-bottom" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
        id="textOffcanvas" aria-labelledby="offcanvasScrollingLabel">
        <div class="offcanvas-header">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="fortextLine1">
                <h4 class="topHeading">For text line 1</h4>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="enableLine1" checked
                            onchange="toggleLine(1)">
                        <label class="form-check-label" for="enableLine1">Enable</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="text1" oninput="updateText(1)" placeholder="">
                        <label for="text1">Enter text line</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-floating">
                        <select class="form-select font-selector" id="fontFamily1" onchange="updateFontFamily(1)"
                            id="floatingSelect" aria-label="Floating label select example">
                            <option selected>Choose fonts from list</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>
                        <label for="fontFamily1">Select font</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <label class="topLabel">Size</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="fontSize1" min="10" max="100" value="50"
                            oninput="updateFontSize(1)">
                        <div class="rightInfoValue"><span id="fontSizeValue1">50</span>
                            px
                        </div>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <label class="topLabel">Position</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="positionY1" min="700" max="1000" value="750"
                            oninput="updateTextPosition(1)">
                        <!-- <div class="rightInfoValue"><span id="positionValue1">750</span> px
                    </div> -->
                    </div>
                </div>
            </div>

            <div class="fortextLine2">
                <h4 class="topHeading">For text line 2</h4>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="enableLine2" checked
                            onchange="toggleLine(2)">
                        <label class="form-check-label" for="enableLine2">Enable</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="text2" oninput="updateText(2)" placeholder="">
                        <label for="text2">Enter text line</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-floating">
                        <select class="form-select font-selector" id="fontFamily2" onchange="updateFontFamily(2)"
                            aria-label="Floating label select example">
                            <option selected>Choose fonts from list</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>
                        <label for="fontFamily2">Select font</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <label class="topLabel">Size</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="fontSize2" min="10" max="100" value="35"
                            oninput="updateFontSize(2)">
                        <div class="rightInfoValue"><span id="fontSizeValue2">35</span>
                            px
                        </div>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <label class="topLabel">Position</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="positionY2" min="750" max="1050" value="1000"
                            oninput="updateTextPosition(2)">
                    </div>
                </div>
            </div>
            <div class="fortextLine3">
                <h4 class="topHeading">For text line 3</h4>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="enableLine3" checked
                            onchange="toggleLine(3)">
                        <label class="form-check-label" for="enableLine3">Enable</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="text3" oninput="updateText(3)" placeholder="">
                        <label for="text3">Enter text line</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <div class="form-floating">
                        <select class="form-select font-selector" id="fontFamily3" onchange="updateFontFamily(3)"
                            aria-label="Floating label select example">
                            <option selected>Choose fonts from list</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>
                        <label for="fontFamily3">Select font</label>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <label class="topLabel">Size</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="fontSize3" min="10" max="100" value="31"
                            oninput="updateFontSize(3)">
                        <div class="rightInfoValue"><span id="fontSizeValue3">31</span>
                            px
                        </div>
                    </div>
                </div>
                <!-- single item -->
                <div class="singleController">
                    <label class="topLabel">Position</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="positionY3" min="800" max="1100" value="850"
                            oninput="updateTextPosition(3)">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- text option off canvas -->
    <div class="offcanvas offcanvas-bottom" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
        id="designOffcanvas" aria-labelledby="offcanvasScrollingLabel">
        <div class="offcanvas-header">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="fortextLine1">
                <div class="singleController">
                    <label class="topLabel">Font Color</label>
                    <div class="rangeDiv">
                        <input type="color" id="fontColor" class="colorControl" value="#ffffff"
                            oninput="updateFontColor()">
                    </div>
                </div>
                <div class="singleController">
                    <label class="topLabel">Color Fill</label>
                    <div class="form-floating">
                        <select class="form-select" id="rectType" onchange="toggleRectangleSettings()">
                            <option value="solid">Solid Color</option>
                            <option value="gradient">Gradient</option>
                        </select>
                        <label for="rectType">Select Fill Style</label>
                    </div>
                </div>
                <div id="solidColorSettings" class="singleController">
                    <label class="topLabel">Background Color</label>
                    <div class="rangeDiv">
                        <input type="color" id="bgColor" class="colorControl" value="#154c79" oninput="updateBgColor()">
                    </div>
                </div>
                <div id="gradientSettings" style="display: none;">
                    <div class="singleController">
                        <div class="row">
                            <div class="col-6">
                                <label class="topLabel">Gradient Color 1</label>
                                <input type="color" id="gradientColor1" class="colorControl" value="#154c79"
                                    oninput="updateGradient()">
                            </div>
                            <div class="col-6">
                                <label class="topLabel">Gradient Color 2</label>
                                <input type="color" id="gradientColor2" class="colorControl" value="#00aaff"
                                    oninput="updateGradient()">
                            </div>
                        </div>
                    </div>
                    <div class="singleController">
                        <label class="topLabel">Gradient Direction</label>
                        <div class="form-floating">
                            <select class="form-select" id="gradientDirection" onchange="updateGradient()">
                                <option value="top-bottom">Top to Bottom</option>
                                <option value="left-right">Left to Right</option>
                                <option value="diagonal">Diagonal</option>
                            </select>
                            <label for="rectType">Select Direction</label>
                        </div>
                    </div>
                </div>
                <div class="singleController">
                    <label class="topLabel">Opacity</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="bgOpacity" min="0" max="100" value="100"
                            oninput="updateBgOpacity()">
                        <div class="rightInfoValue"><span id="bgOpacityValue">100%</span></div>
                    </div>
                </div>
            </div>
            <div class="fortextLine1">
                <div class="singleController">
                    <label class="topLabel">Left Crop</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="leftCrop" min="0" max="100" value="0"
                            oninput="updateBoxCrop()">
                        <div class="rightInfoValue"><span id="leftCropValue">0%</span>
                        </div>
                    </div>
                </div>
                <div class="singleController">
                    <label class="topLabel">Right Crop</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="rightCrop" min="0" max="100" value="0"
                            oninput="updateBoxCrop()">
                        <div class="rightInfoValue"><span id="rightCropValue">0%</span>
                        </div>
                    </div>
                </div>
                <div class="singleController">
                    <label class="topLabel">Rounded Edges</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="roundedEdges" min="0" max="100" value="0"
                            oninput="updateRoundedEdges()">
                        <div class="rightInfoValue"><span id="roundedEdgesValue">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="fortextLine1">
                <div class="singleController">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="strokeEnabled"
                            onchange="toggleStroke()">
                        <label class="form-check-label" for="strokeEnabled">Enable
                            Stroke</label>
                    </div>
                </div>
                <div id="strokeSettings">
                    <div class="singleController">
                        <label class="topLabel">Stroke Thickness</label>
                        <div class="rangeDiv">
                            <input type="range" class="form-range" id="strokeWidth" min="1" max="20" value="2"
                                oninput="updateStroke()">
                            <div class="rightInfoValue"><span id="strokeWidthValue">2px</span>
                            </div>
                        </div>
                    </div>
                    <div class="singleController">
                        <label class="topLabel">Stroke Color</label>
                        <div class="rangeDiv">
                            <input type="color" id="strokeColor" class="colorControl" value="#ffffff"
                                oninput="updateStroke()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- text option off canvas -->
    <div class="offcanvas offcanvas-bottom" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
        id="alignmentOffcanvas" aria-labelledby="offcanvasScrollingLabel">
        <div class="offcanvas-header">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="fortextLine1">
                <div class="singleController">
                    <label class="topLabel">Text Alignment</label>
                    <div class="form-floating">
                        <select class="form-select" id="textAlignment" onchange="updateTextAlignment()"
                            aria-label="Floating label select example">
                            <option value="left">Left</option>
                            <option value="center">Center</option>
                            <option value="right">Right</option>
                        </select>
                        <label for="fontFamily1">Select align </label>
                    </div>
                </div>
                <div class="singleController">
                    <label class="topLabel">Text Margin</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="textMargin" min="-100" max="100" value="0">
                        <div class="rightInfoValue"><span id="textMarginValue">40</span>
                        </div>
                    </div>
                </div>
                <div class="singleController">
                    <label class="topLabel">Rectangle Height</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="rectHeight" min="50" max="200" value="100"
                            oninput="updateRectangleHeight()">
                        <div class="rightInfoValue"><span id="rectHeightValue">100%</span>
                        </div>
                    </div>
                </div>
                <div class="singleController">
                    <label class="topLabel">Vertical Position</label>
                    <div class="rangeDiv">
                        <input type="range" class="form-range" id="verticalPosition" min="-100" max="100" value="0">
                        <div class="rightInfoValue"><span id="verticalPositionValue">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
    <script src="./assets/js/jquery-3.3.1.min.js"></script>
    <script src="./assets/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./assets/js/editor.js"></script>
    <script type="module" src="./assets/js/app.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script>
        let canvas = new fabric.Canvas('lowerThirdCanvas');
        let bgRect, text1, text2, text3, bgImage = null;


        // Constants and Initial Values
        const GOOGLE_FONTS_API_KEY = 'AIzaSyB8VYq4-yRAvtFwZ1MdF_xn8PulMgZXLiI';
        const FULL_WIDTH = 1920;
        const FULL_HEIGHT = 1080;
        const PREVIEW_WIDTH = 768;
        const PREVIEW_HEIGHT = 432;
        const SCALE_FACTOR = 0.4;

        let baseRectWidth = 0;
        let baseRectHeight = 0;
        let baseRectLeft = 0;
        let baseRectTop = 0;

        let originalRectWidth = 0;
        let originalRectLeft = 0;

        const INITIAL_FONTS = {
            fontFamily1: 'Roboto',
            fontFamily2: 'Roboto',
            fontFamily3: 'Roboto'
        };

        const SYSTEM_FONTS = ['Arial', 'Helvetica', 'Verdana', 'Georgia'];

        const ALLOWED_FONTS = [
            'Roboto',
            'Open Sans',
            'Lato',
            'Montserrat',
            'Poppins',
            'Oswald',
            'Raleway',
            'Merriweather',
            'Nunito',
            'Playfair Display'
        ];

        const loadedFonts = new Set();

        const INITIAL_VALUES = {
            text1: 'John Smith',
            text2: 'Graphic Designer, Simple Thirds',
            text3: 'Additional Information Here',
            fontColor: '#ffffff',
            fontSize1: 50,
            fontSize2: 35,
            fontSize3: 31,
            lineSpacing1: 50,
            lineSpacing2: 50,
            bottomHeight: 100,
            bgColor: '#154c79',
            bgOpacity: 100,
            textAlignment: 'left',
            textMargin: 0,
            leftCrop: 0,
            rightCrop: 0,
            roundedEdges: 0,
            rectType: 'solid',
            gradientColor1: '#000000',
            gradientColor2: '#ffffff',
            gradientDirection: 'left-right',
            rectHeight: 100,
            rectPadding: 0,
            baseHeight: 100,
            strokeEnabled: false,
            strokeWidth: 2,
            strokeColor: '#ffffff',
            fontFamily1: 'Roboto',
            fontFamily2: 'Roboto',
            fontFamily3: 'Roboto',
            verticalPosition: 0
        };

        let bottomHeight = 100;
        let verticalOffset = 100;
        let verticalOffsetPercent = 0;
        const MAX_VERTICAL_OFFSET = 0;
        const MAX_VERTICAL_RANGE = 100;

        // Initial Setup
        function initializeCanvas() {
            canvas.clear();

            const baseTop = calculateYPosition();

            bgRect = new fabric.Rect({
                left: (FULL_WIDTH * INITIAL_VALUES.leftCrop / 100) * SCALE_FACTOR,
                top: baseTop,
                width: FULL_WIDTH * (1 - (INITIAL_VALUES.leftCrop + INITIAL_VALUES.rightCrop) / 100) * SCALE_FACTOR, // Fixed parentheses
                height: 150 * SCALE_FACTOR,
                fill: '#154c79',
                opacity: INITIAL_VALUES.bgOpacity / 100,
                rx: 0,
                ry: 0,
                selectable: false
            });

            baseRectWidth = bgRect.width;
            baseRectHeight = bgRect.height;
            baseRectLeft = bgRect.left;
            baseRectTop = bgRect.top;
            originalRectWidth = bgRect.width;
            originalRectLeft = bgRect.left;

            const verticalSlider = document.getElementById('verticalPosition');
            verticalSlider.min = -MAX_VERTICAL_RANGE;
            verticalSlider.max = 7;
            verticalSlider.value = 0;

            bgRect.baseTop = baseTop; // Set baseTop for rectangle

            // Text Elements
            text1 = createTextElement(1, bgRect.top + 20 * SCALE_FACTOR - 4);
            text2 = createTextElement(2, text1.top + INITIAL_VALUES.lineSpacing1 * SCALE_FACTOR);
            text3 = createTextElement(3, text2.top + INITIAL_VALUES.lineSpacing2 * SCALE_FACTOR - 3);

            canvas.add(bgRect, text1, text2, text3);
            loadSampleBackground();
            canvas.renderAll();
        }

        // creating text elements
        function createTextElement(line, topPos) {
            const text = new fabric.Text(INITIAL_VALUES[`text${line}`], {
                left: 100 * SCALE_FACTOR,
                top: topPos,
                fontSize: INITIAL_VALUES[`fontSize${line}`] * SCALE_FACTOR,
                fill: '#ffffff',
                // fontFamily: INITIAL_VALUES[`fontFamily${line}`],
                selectable: false,
                textAlign: INITIAL_VALUES.textAlignment,
                visible: true
            });
            text.baseTop = topPos; // Set baseTop here
            return text;
        }

        function calculateYPosition() {
            const baseHeight = 150;
            const currentHeight = baseHeight * (document.getElementById('rectHeight').value / 100);

            // Get current bottom height from the slider
            bottomHeight = document.getElementById('bottomHeight')?.value || INITIAL_VALUES.bottomHeight;

            return (FULL_HEIGHT - bottomHeight - currentHeight) * SCALE_FACTOR;
        }

        // Reset Function
        function resetLowerThird() {
            console.log('hello world')


            // Reset UI Controls
            Object.keys(INITIAL_VALUES).forEach(key => {
                const el = document.getElementById(key);
                if (el) {
                    if (el.type === 'checkbox') {
                        el.checked = true;
                    } else {
                        el.value = INITIAL_VALUES[key];
                    }
                }
            });

            // Update value displays
            document.querySelectorAll('[id$="Value"]').forEach(el => {
                const prop = el.id.replace('Value', '');
                el.textContent = INITIAL_VALUES[prop] || document.getElementById(prop).value;
            });

            // Explicitly reset font size displays
            document.getElementById('fontSizeValue1').textContent = INITIAL_VALUES.fontSize1;
            document.getElementById('fontSizeValue2').textContent = INITIAL_VALUES.fontSize2;
            document.getElementById('fontSizeValue3').textContent = INITIAL_VALUES.fontSize3;

            // Explicitly set font color
            document.getElementById('fontColor').value = INITIAL_VALUES.fontColor;
            [text1, text2, text3].forEach(t => t.set({ fill: INITIAL_VALUES.fontColor }));

            // set 0% for crop value
            document.getElementById("leftCropValue").textContent = "0%";
            document.getElementById("rightCropValue").textContent = "0%";

            document.getElementById("bgOpacityValue").textContent = "100%";
            document.getElementById("roundedEdgesValue").textContent = "0%";


            // Reset position controls
            [1, 2, 3].forEach(line => {
                const checkbox = document.getElementById(`enableLine${line}`);
                const slider = document.getElementById(`positionY${line}`);

                checkbox.checked = true;
                // Reset to default values
                const defaults = { 1: 750, 2: 800, 3: 850 };
                slider.value = defaults[line];
            });

            // Reset height control
            document.getElementById('rectHeight').value = INITIAL_VALUES.rectHeight;
            document.getElementById('rectHeightValue').textContent = INITIAL_VALUES.rectHeight + '%';

            // Reset stroke controls
            document.getElementById('strokeEnabled').checked = INITIAL_VALUES.strokeEnabled;
            document.getElementById('strokeWidth').value = INITIAL_VALUES.strokeWidth;
            document.getElementById('strokeColor').value = INITIAL_VALUES.strokeColor;
            document.getElementById('strokeWidthValue').textContent = `${INITIAL_VALUES.strokeWidth}px`;
            toggleStrokeSettings(INITIAL_VALUES.strokeEnabled);



            initializeCanvas();
            updateTextAlignment();
            updateBoxCrop();
            updateRoundedEdges();
            toggleRectangleSettings();
        }

        // Update Functions
        function updateText(line) {
            const newText = document.getElementById(`text${line}`).value;
            // Directly access the text objects
            switch (line) {
                case 1:
                    text1.set({ text: newText });
                    break;
                case 2:
                    text2.set({ text: newText });
                    break;
                case 3:
                    text3.set({ text: newText });
                    break;
            }
            canvas.renderAll();
        }

        // Update font size
        function updateFontSize(line) {
            const newSize = document.getElementById(`fontSize${line}`).value;
            document.getElementById(`fontSizeValue${line}`).textContent = newSize;
            switch (line) {
                case 1:
                    text1.set({ fontSize: newSize * SCALE_FACTOR });
                    break;
                case 2:
                    text2.set({ fontSize: newSize * SCALE_FACTOR });
                    break;
                case 3:
                    text3.set({ fontSize: newSize * SCALE_FACTOR });
                    break;
            }
            canvas.renderAll();
        }

        // update position
        function updateTextPosition(line) {
            const newY = document.getElementById(`positionY${line}`).value * SCALE_FACTOR;
            switch (line) {
                case 1:
                    text1.set({ top: newY });
                    break;
                case 2:
                    text2.set({ top: newY });
                    break;
                case 3:
                    text3.set({ top: newY });
                    break;
            }
            canvas.renderAll();
        }

        // line toggle active and function
        function toggleLine(line) {
            const isEnabled = document.getElementById(`enableLine${line}`).checked;
            const positionSlider = document.getElementById(`positionY${line}`);
            if (line === 1) {
                text1.set({ visible: isEnabled });
                // positionSlider.disabled = !isEnabled;
            }
            if (line === 2) {
                text2.set({ visible: isEnabled });
                // positionSlider.disabled = !isEnabled;
            }
            if (line === 3) {
                text3.set({ visible: isEnabled });
                // positionSlider.disabled = !isEnabled;
            }
            canvas.renderAll();
        }


        function updateLineSpacing() {
            lineSpacing1 = document.getElementById('lineSpacing1').value;
            lineSpacing2 = document.getElementById('lineSpacing2').value;
            text2.set({ top: text1.top + lineSpacing1 * SCALE_FACTOR });
            text3.set({ top: text2.top + lineSpacing2 * SCALE_FACTOR });
            canvas.renderAll();
        }

        function updateBottomHeight() {
            bottomHeight = document.getElementById('bottomHeight').value;
            bgRect.set({ top: calculateYPosition() });
            // Update text positions...
            canvas.renderAll();
        }

        function updateFontColor() {
            const newColor = document.getElementById('fontColor').value;
            [text1, text2, text3].forEach(t => t.set({ fill: newColor }));
            canvas.renderAll();
        }


        function updateTextAlignment() {
            const margin = parseInt(document.getElementById("textMargin").value) || 100 * SCALE_FACTOR;
            document.getElementById("textMarginValue").textContent = margin;
            const alignment = document.getElementById("textAlignment").value;

            // Get background rectangle boundaries
            const bgLeft = bgRect.left;
            const bgRight = bgRect.left + bgRect.width;

            [text1, text2, text3].forEach(t => {
                switch (alignment) {
                    case "left":
                        // Left edge of bgRect + margin
                        t.set({ left: bgLeft + margin });
                        break;

                    case "center":
                        // Center of bgRect - text width/2 + margin
                        t.set({
                            left: bgLeft + (bgRect.width / 2) - (t.getScaledWidth() / 2) + margin
                        });
                        break;

                    case "right":
                        // Right edge of bgRect - text width - margin
                        t.set({
                            left: bgRight - t.getScaledWidth() - margin
                        });
                        break;
                }
            });

            canvas.renderAll();
        }

        // Remove updateTextMargin and use this single function
        document.getElementById('textMargin').addEventListener('input', updateTextAlignment);
        document.getElementById('textAlignment').addEventListener('change', updateTextAlignment);


        function updateBoxCrop() {
            const leftCrop = document.getElementById('leftCrop').value;
            const rightCrop = document.getElementById('rightCrop').value;

            document.getElementById("leftCropValue").textContent = leftCrop + "%";
            document.getElementById("rightCropValue").textContent = rightCrop + "%";

            const newLeft = (FULL_WIDTH * leftCrop / 100) * SCALE_FACTOR;
            const newWidth = FULL_WIDTH * (1 - (leftCrop / 100 + rightCrop / 100)) * SCALE_FACTOR;

            bgRect.set({
                left: newLeft,
                width: newWidth
            });

            // Update original dimensions to current cropped values
            originalRectWidth = newWidth;
            originalRectLeft = newLeft;

            baseRectWidth = newWidth;
            baseRectLeft = newLeft;

            canvas.renderAll();
        }

        function updateRoundedEdges() {
            const roundedValue = document.getElementById('roundedEdges').value;
            document.getElementById('roundedEdgesValue').textContent = roundedValue + '%';
            const radius = 300 * (roundedValue / 100) * SCALE_FACTOR;
            bgRect.set({ rx: radius, ry: radius });
            canvas.renderAll();
        }

        // Background Functions
        function loadSampleBackground() {
            if (bgImage) canvas.remove(bgImage);

            fabric.Image.fromURL("./assets/images/sample-bg.jpg", img => {
                img.set({
                    scaleX: PREVIEW_WIDTH / img.width,
                    scaleY: PREVIEW_HEIGHT / img.height,
                    selectable: false,
                    evented: false
                });
                bgImage = img;
                canvas.add(img);
                canvas.sendToBack(img);
                canvas.renderAll();
            });
        }

        function toggleRectangleSettings() {
            const type = document.getElementById('rectType').value;
            const solidSettings = document.getElementById('solidColorSettings');
            const gradientSettings = document.getElementById('gradientSettings');

            switch (type) {
                case 'solid':
                    solidSettings.style.display = 'flex';
                    gradientSettings.style.display = 'none';
                    updateBgColor(); // Update with solid color
                    break;

                case 'gradient':
                    solidSettings.style.display = 'none';
                    gradientSettings.style.display = 'flex';
                    updateGradient(); // Update with gradient
                    break;

                default:
                    // Hide both if unknown type
                    solidSettings.style.display = 'none';
                    gradientSettings.style.display = 'none';
                    console.warn('Unknown rectangle type:', type);
            }
        }

        function updateGradient() {
            const color1 = document.getElementById('gradientColor1').value;
            const color2 = document.getElementById('gradientColor2').value;
            const direction = document.getElementById('gradientDirection').value;

            const gradient = {
                type: 'linear',
                gradientUnits: 'percentage',
                colorStops: [
                    { offset: 0, color: color1 },
                    { offset: 1, color: color2 }
                ],
                coords: {
                    'top-bottom': { x1: 0, y1: 0, x2: 0, y2: 1 },
                    'left-right': { x1: 0, y1: 0, x2: 1, y2: 0 },
                    'diagonal': { x1: 0, y1: 0, x2: 1, y2: 1 }
                }[direction]
            };

            bgRect.set({ fill: new fabric.Gradient(gradient) });
            canvas.renderAll();
        }

        function updateBgColor() {
            bgRect.set({ fill: document.getElementById('bgColor').value });
            canvas.renderAll();
        }

        function updateBgOpacity() {
            const opacityValue = document.getElementById('bgOpacity').value;
            document.getElementById('bgOpacityValue').textContent = opacityValue + '%';
            bgRect.set({ opacity: opacityValue / 100 });
            canvas.renderAll();
        }


        function updateRectangleHeight() {
            const currentVisualTop = bgRect.top;
            const currentVerticalOffset = parseInt(document.getElementById('verticalPosition').value) || 0;




            const heightPercent = document.getElementById('rectHeight').value;
            document.getElementById('rectHeightValue').textContent = heightPercent + '%';

            // Get current line spacing values from DOM
            const lineSpacing1 = document.getElementById('lineSpacing1')?.value || INITIAL_VALUES.lineSpacing1;
            const lineSpacing2 = document.getElementById('lineSpacing2')?.value || INITIAL_VALUES.lineSpacing2;

            // Calculate new height (base height is 150px)
            const baseHeight = 150;
            const newHeight = baseHeight * (heightPercent / 100);

            baseRectHeight = 150 * (heightPercent / 100) * SCALE_FACTOR;

            // Calculate new base position without vertical offset
            const newBaseTop = (FULL_HEIGHT - INITIAL_VALUES.bottomHeight - newHeight) * SCALE_FACTOR;




            // Re-apply stroke adjustments
            updateStroke();
            document.getElementById('rectHeightValue').textContent = heightPercent + '%';





            // Update rectangle height and maintain bottom position
            bgRect.set({
                height: newHeight * SCALE_FACTOR,
                // top: calculateYPosition()
                baseTop: newBaseTop,
                // top: newBaseTop + (currentVisualTop - bgRect.baseTop)
                top: newBaseTop
            });

            // Update text positions relative to new height
            const textVerticalStart = bgRect.top + 20 * SCALE_FACTOR;
            // Update text base positions
            text1.set({ top: textVerticalStart });
            text2.set({ top: text1.top + lineSpacing1 * SCALE_FACTOR });
            text3.set({ top: text2.top + lineSpacing2 * SCALE_FACTOR });

            // Store new base positions
            bgRect.baseTop = newBaseTop;
            text1.baseTop = text1.top;
            text2.baseTop = text2.top;
            text3.baseTop = text3.top;

            baseRectHeight = bgRect.height;
            baseRectTop = bgRect.top;

            // Re-apply vertical offset
            document.getElementById('verticalPosition').value = currentVerticalOffset;
            applyVerticalPosition();

            canvas.requestRenderAll();
            updateBoxCrop();
        }

        // Initialize stroke settings
        function initStroke() {
            document.getElementById('strokeEnabled').checked = INITIAL_VALUES.strokeEnabled;
            document.getElementById('strokeWidth').value = INITIAL_VALUES.strokeWidth;
            document.getElementById('strokeColor').value = INITIAL_VALUES.strokeColor;
            document.getElementById('strokeWidthValue').textContent = `${INITIAL_VALUES.strokeWidth}px`;
            toggleStrokeSettings(INITIAL_VALUES.strokeEnabled);
        }

        // Toggle stroke visibility
        function toggleStroke() {
            const enabled = document.getElementById('strokeEnabled').checked;
            toggleStrokeSettings(enabled);
            updateStroke();
        }

        function toggleStrokeSettings(show) {
            document.getElementById('strokeSettings').style.display = show ? 'flex' : 'none';
        }

        // Update stroke properties
        function updateStroke() {
            const enabled = document.getElementById('strokeEnabled').checked;
            const width = parseInt(document.getElementById('strokeWidth').value);
            const color = document.getElementById('strokeColor').value;

            if (enabled) {
                // Reduce width only from right side
                bgRect.set({
                    stroke: color,
                    strokeWidth: width,
                    width: originalRectWidth - width, // Decrease from right
                    left: originalRectLeft, // Maintain original left position
                    height: bgRect.height // Keep original height
                });
            } else {
                // Restore original dimensions
                bgRect.set({
                    stroke: null,
                    strokeWidth: 0,
                    width: originalRectWidth,
                    left: originalRectLeft
                });
            }

            canvas.renderAll();
        }
        // Initialize stroke settings when page loads
        initStroke();


        // for fonts load
        async function initializeFonts() {
            try {
                const response = await fetch(`https://www.googleapis.com/webfonts/v1/webfonts?key=${GOOGLE_FONTS_API_KEY}`);
                const data = await response.json();

                // Filter to only allowed fonts
                const allowedFontData = data.items.filter(font =>
                    ALLOWED_FONTS.includes(font.family)
                );

                populateFontSelectors(allowedFontData);
                loadInitialFonts();

            } catch (error) {
                console.error('Using fallback font loading:', error);
                loadFontsFallback();
            }
        }

        function populateFontSelectors(fonts) {
            document.querySelectorAll('.font-selector').forEach((select, index) => {
                select.innerHTML = '';

                // Add allowed Google Fonts
                fonts.forEach(font => {
                    const option = document.createElement('option');
                    option.value = font.family;
                    option.textContent = font.family;
                    option.dataset.googleFont = true;
                    select.appendChild(option);
                });

                // Add system fonts separator
                const separator = document.createElement('option');
                separator.disabled = true;
                separator.textContent = '── System Fonts ──';
                select.appendChild(separator);

                // Add system fonts
                SYSTEM_FONTS.forEach(font => {
                    const option = document.createElement('option');
                    option.value = font;
                    option.textContent = font;
                    select.appendChild(option);
                });

                select.value = INITIAL_FONTS[select.id] || ALLOWED_FONTS[index];
            });
        }

        function loadInitialFonts() {
            WebFont.load({
                google: {
                    families: Object.values(INITIAL_FONTS)
                },
                active: () => {
                    loadedFonts.add(...Object.values(INITIAL_FONTS));
                    initializeCanvas();
                },
                inactive: initializeCanvas
            });
        }

        function loadFontsFallback() {
            // Directly attempt to load allowed fonts
            WebFont.load({
                google: {
                    families: ALLOWED_FONTS
                },
                active: () => {
                    document.querySelectorAll('.font-selector').forEach((select, index) => {
                        select.innerHTML = ALLOWED_FONTS.map(font =>
                            `<option value="${font}">${font}</option>`
                        ).join('');
                        select.value = INITIAL_FONTS[select.id] || ALLOWED_FONTS[index];
                    });
                    initializeCanvas();
                }
            });
        }

        async function updateFontFamily(line) {
            const select = document.getElementById(`fontFamily${line}`);
            const font = select.value;
            const textElement = [text1, text2, text3][line - 1];

            if (SYSTEM_FONTS.includes(font)) {
                textElement.set({ fontFamily: font });
                canvas.requestRenderAll();
                return;
            }

            if (!loadedFonts.has(font)) {
                try {
                    await new Promise((resolve, reject) => {
                        WebFont.load({
                            google: { families: [font] },
                            active: resolve,
                            inactive: reject
                        });
                    });
                    loadedFonts.add(font);
                } catch (error) {
                    console.error(`Failed to load ${font}:`, error);
                    textElement.set({ fontFamily: 'Arial' });
                    select.value = 'Arial';
                    canvas.requestRenderAll();
                    return;
                }
            }

            textElement.set({ fontFamily: font });
            canvas.requestRenderAll();
        }


        // Vertical position handler
        // Vertical slider handler (fixed)
        document.getElementById('verticalPosition').addEventListener('input', function () {
            if (!bgRect || !text1 || !text2 || !text3) return;
            verticalOffsetPercent = parseInt(this.value);
            document.getElementById('verticalPositionValue').textContent = `${verticalOffsetPercent}%`;

            applyVerticalPosition();

            // // Calculate pixel offset
            // const pixelOffset = (verticalOffset / 100) * canvasHeight;

            // // Move all elements using stored base positions
            // bgRect.set({ top: bgRect.baseTop + pixelOffset });
            // text1.set({ top: text1.baseTop + pixelOffset });
            // text2.set({ top: text2.baseTop + pixelOffset });
            // text3.set({ top: text3.baseTop + pixelOffset });

            // canvas.requestRenderAll();
        });

        function applyVerticalPosition() {
            const verticalOffset = parseInt(document.getElementById('verticalPosition').value) || 0;
            const pixelOffset = (verticalOffset / 100) * canvas.getHeight();

            bgRect.set({ top: bgRect.baseTop + pixelOffset });
            text1.set({ top: text1.baseTop + pixelOffset });
            text2.set({ top: text2.baseTop + pixelOffset });
            text3.set({ top: text3.baseTop + pixelOffset });

            canvas.requestRenderAll();
        }





        function exportAsPNG() {
            const resolution = document.getElementById("resolutionToggle").value;
            let exportWidth, exportHeight, resolutionScale;

            const isStrokeEnabled = document.getElementById('strokeEnabled').checked;

            const verticalOffset = parseInt(document.getElementById('verticalPosition').value) || 0;

            const selectedFonts = [
                document.getElementById('fontFamily1').value,
                document.getElementById('fontFamily2').value,
                document.getElementById('fontFamily3').value
            ].filter(font => !SYSTEM_FONTS.includes(font));



            WebFont.load({
                google: { families: selectedFonts },
                active: () => {
                    // Get current height percentage
                    const heightPercent = document.getElementById('rectHeight').value || 100;

                    // Get crop values
                    const leftCrop = parseInt(document.getElementById("leftCrop").value) || 0;
                    const rightCrop = parseInt(document.getElementById("rightCrop").value) || 0;
                    const totalCrop = Math.min(leftCrop + rightCrop, 95);


                    // Get current values from UI controls
                    const currentBottomHeight = document.getElementById('bottomHeight')?.value || INITIAL_VALUES.bottomHeight;
                    const lineSpacing1 = document.getElementById('lineSpacing1')?.value || INITIAL_VALUES.lineSpacing1;
                    const lineSpacing2 = document.getElementById('lineSpacing2')?.value || INITIAL_VALUES.lineSpacing2;
                    const rectHeight = document.getElementById('rectHeight')?.value || INITIAL_VALUES.rectHeight;

                    const strokeWidth = bgRect.strokeWidth || 0;
                    const visibleWidth = baseRectWidth / SCALE_FACTOR - (strokeWidth * 2);
                    const visibleHeight = baseRectHeight / SCALE_FACTOR - (strokeWidth * 2);





                    // Set resolution parameters
                    if (resolution === "hd") {
                        exportWidth = 1920;
                        exportHeight = 1080;
                        resolutionScale = 1;

                    } else {
                        exportWidth = 3840;
                        exportHeight = 2160;
                        resolutionScale = 2;

                    }



                    const bgWidth = exportWidth * (1 - totalCrop / 100);
                    const bgLeft = exportWidth * (leftCrop / 100);
                    const baseHeight = 150 * (heightPercent / 100);
                    // const bgHeight = baseHeight * resolutionScale;
                    // const bgTop = exportHeight - (currentBottomHeight * resolutionScale) - bgHeight;
                    const bgBaseTop = (bgRect.baseTop / SCALE_FACTOR) * resolutionScale;
                    const bgHeight = (bgRect.height / SCALE_FACTOR) * resolutionScale;


                    const verticalPixelOffset = (verticalOffset / 100) * exportHeight;
                    // Create temporary canvas
                    const tempCanvas = new fabric.StaticCanvas(null, {
                        width: exportWidth,
                        height: exportHeight
                    });


                    let finalWidth;
                    switch (resolution.toLowerCase()) {
                        case '4k':
                            finalWidth = isStrokeEnabled
                                ? bgWidth - (strokeWidth + 75)
                                : bgWidth;
                            break;

                        case 'hd':
                        default:
                            finalWidth = isStrokeEnabled
                                ? bgWidth - (strokeWidth + 40)
                                : bgWidth;
                            break;
                    }

                    let bgTop = bgBaseTop + verticalPixelOffset;
                    bgTop = Math.max(0, Math.min(bgTop, exportHeight - bgHeight));

                    const bgClone = new fabric.Rect({
                        left: bgLeft,
                        top: bgTop,
                        width: finalWidth,
                        height: bgHeight,
                        fill: bgRect.fill,
                        opacity: bgRect.opacity,
                        rx: bgRect.rx / SCALE_FACTOR * resolutionScale,
                        ry: bgRect.ry / SCALE_FACTOR * resolutionScale,
                        stroke: bgRect.stroke,
                        strokeWidth: (strokeWidth / SCALE_FACTOR) * resolutionScale, // Critical fix
                        strokeUniform: true
                    });

                    // // Clone text elements without position changes
                    // const textOffset = (strokeWidth / SCALE_FACTOR) * resolutionScale;
                    // const text1Clone = new fabric.Text(text1.text, {
                    //     ...text1.toObject(),
                    //     left: (text1.left / SCALE_FACTOR) * resolutionScale,
                    //     top: (text1.top / SCALE_FACTOR) * resolutionScale,
                    //     fontSize: (text1.fontSize / SCALE_FACTOR) * resolutionScale,
                    //     fontFamily: fontFamily,
                    // });

                    // const text2Clone = new fabric.Text(text2.text, {
                    //     ...text2.toObject(),
                    //     left: (text2.left / SCALE_FACTOR) * resolutionScale,
                    //     top: (text2.top / SCALE_FACTOR) * resolutionScale,
                    //     fontSize: (text2.fontSize / SCALE_FACTOR) * resolutionScale,
                    //     fontFamily: fontFamily,
                    // });

                    // const text3Clone = new fabric.Text(text3.text, {
                    //     ...text3.toObject(),
                    //     left: (text3.left / SCALE_FACTOR) * resolutionScale,
                    //     top: (text3.top / SCALE_FACTOR) * resolutionScale,
                    //     fontSize: (text3.fontSize / SCALE_FACTOR) * resolutionScale,
                    //     fontFamily: fontFamily,
                    // });

                    const cloneTextElement = (textElement) => {
                        const textBaseTop = (textElement.baseTop / SCALE_FACTOR) * resolutionScale;
                        const textTop = textBaseTop + verticalPixelOffset;

                        return new fabric.Text(textElement.text, {
                            ...textElement.toObject(),
                            left: (textElement.left / SCALE_FACTOR) * resolutionScale,
                            top: textTop,
                            fontSize: (textElement.fontSize / SCALE_FACTOR) * resolutionScale,
                            fontFamily: document.fonts.check(`12px "${textElement.fontFamily}"`)
                                ? textElement.fontFamily
                                : DEFAULT_FALLBACK_FONT
                        });
                    };

                    const text1Clone = cloneTextElement(text1);
                    const text2Clone = cloneTextElement(text2);
                    const text3Clone = cloneTextElement(text3);

                    // Add elements
                    tempCanvas.add(bgClone, text1Clone, text2Clone, text3Clone);
                    tempCanvas.renderAll();

                    // Export
                    const link = document.createElement('a');
                    link.href = tempCanvas.toDataURL({ format: 'png' });
                    link.download = `lower_third_${resolution}.png`;
                    link.click();
                    tempCanvas.dispose();
                },
                inactive: () => {
                    console.error('Failed to load fonts for export');
                    alert('Error: Could not load required fonts for export');
                }
            });





        }






        // Initialization
        document.getElementById('lowerThirdCanvas').width = PREVIEW_WIDTH;
        document.getElementById('lowerThirdCanvas').height = PREVIEW_HEIGHT;
        canvas.setDimensions({ width: PREVIEW_WIDTH, height: PREVIEW_HEIGHT });
        document.addEventListener('DOMContentLoaded', initializeFonts);
        initializeCanvas();
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Target all offcanvas elements
            document.querySelectorAll('.offcanvas').forEach((offcanvas) => {
                // When offcanvas opens
                offcanvas.addEventListener('show.bs.offcanvas', (event) => {
                    document.body.classList.add('body-offcanvas-active');
                    const offcanvasId = event.target.id; // Get the offcanvas ID
                    // Find the button(s) that triggered this offcanvas
                    const buttons = document.querySelectorAll(
                        `[data-bs-toggle="offcanvas"][data-bs-target="#${CSS.escape(offcanvasId)}"]`
                    );
                    // Add 'active' class to all relevant buttons
                    buttons.forEach(btn => btn.classList.add('active'));
                });

                // When offcanvas closes
                offcanvas.addEventListener('hide.bs.offcanvas', (event) => {
                    document.body.classList.remove('body-offcanvas-active');
                    const offcanvasId = event.target.id;
                    const buttons = document.querySelectorAll(
                        `[data-bs-toggle="offcanvas"][data-bs-target="#${CSS.escape(offcanvasId)}"]`
                    );
                    // Remove 'active' class from all relevant buttons
                    buttons.forEach(btn => btn.classList.remove('active'));
                });
            });
        });
    </script>
    <script>
        // Store the original content of the div
        let originalRightDivContent = '';

        // Function to clear or restore content based on screen width
        const handleMobileView = () => {
            const rightDiv = document.querySelector('.mainEditorWrapper .left');
            if (!rightDiv) return;

            // Initialize original content if empty
            if (!originalRightDivContent) {
                originalRightDivContent = rightDiv.innerHTML;
            }

            // Check screen width
            if (window.innerWidth <= 767) {
                rightDiv.innerHTML = ''; // Clear content on mobile
            } else {
                rightDiv.innerHTML = originalRightDivContent; // Restore content on desktop
            }
        };

        // Run on page load
        handleMobileView();

        // Update on window resize (with debounce for performance)
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(handleMobileView, 100);
        });
    </script>
</body>

</html>